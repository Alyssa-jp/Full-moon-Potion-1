<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Potion Aligner v2</title>
<style>
:root{
  --stage: min(92vw, 520px);

  /* 初期値（ドラッグで更新される） */
  --cap-top: 7%;
  --cap-left: 31%;
  --cap-width: 27%;
  --liq-left: 19%;
  --liq-top: 47%;
  --liq-width: 62%;
  --liq-height: 30%;
}

html,body{margin:0;height:100%;background:#0b0f14;display:grid;place-items:center;color:#eaf6ff;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
.stage{position:relative;width:var(--stage);aspect-ratio:1/1;isolation:isolate}

/* 画像は掴めるように pointer-events を殺さない */
.stage img{user-select:none;-webkit-user-drag:none}

/* 瓶（最上・輪郭を見せたい） */
#Bottle{position:absolute;inset:0;width:100%;height:auto;z-index:3;filter:drop-shadow(0 14px 32px rgba(0,0,0,.45))}

/* 液体ボックス（ドラッグ＆ピンチ対象） */
.liq-box{
  position:absolute;left:var(--liq-left);top:var(--liq-top);
  width:var(--liq-width);height:var(--liq-height);
  border:2px dashed rgba(120,180,255,.78);
  border-radius:26%/22%; z-index:2; box-sizing:border-box;
  background:linear-gradient(145deg, rgba(40,60,90,.25), transparent);
  cursor:grab; pointer-events:auto;
}
.liq-box:active{cursor:grabbing}
#Liquid{position:absolute;inset:-6% -6% -6% -6%;width:112%;height:auto;object-fit:cover;opacity:.9;mix-blend-mode:multiply}

/* 蓋（ドラッグ対象） */
#Cap{
  position:absolute;width:var(--cap-width);left:var(--cap-left);top:var(--cap-top);
  z-index:4; filter:drop-shadow(0 8px 22px rgba(0,0,0,.5));
  cursor:grab; outline:2px dashed rgba(255,210,120,.75); outline-offset:4px; border-radius:10px;
  pointer-events:auto;
}
#Cap:active{cursor:grabbing}

/* HUD */
.hud{
  position:fixed;right:12px;bottom:12px;background:#0f1520cc;
  border:1px solid #2a3648;border-radius:12px;padding:10px 12px;backdrop-filter:blur(6px);
  min-width:260px; font:12px/1.5 ui-monospace,Menlo,monospace;
}
.row{display:flex;justify-content:space-between;gap:8px}
.btns{display:flex;gap:8px;margin-top:8px}
button{background:#161a20;color:#eaf6ff;border:1px solid #2a3648;border-radius:10px;padding:8px 12px;font-weight:600}
.hint{opacity:.75;margin-top:6px}
</style>
</head>
<body>

<div class="stage" id="stage">
  <!-- 液体（枠内だけに表示） -->
  <div class="liq-box" id="liqBox">
    <img id="Liquid" src="Liquid.PNG" alt="liquid">
  </div>

  <!-- 瓶 -->
  <img id="Bottle" src="Bottle.PNG" alt="bottle">

  <!-- 蓋 -->
  <img id="Cap" src="Cap.PNG" alt="cap">
</div>

<div class="hud">
  <div class="row"><div>cap-left :</div><div id="capL">--</div></div>
  <div class="row"><div>cap-top  :</div><div id="capT">--</div></div>
  <div class="row"><div>liq-left :</div><div id="liqL">--</div></div>
  <div class="row"><div>liq-top  :</div><div id="liqT">--</div></div>
  <div class="row"><div>liq-width:</div><div id="liqW">--</div></div>
  <div class="row"><div>liq-height:</div><div id="liqH">--</div></div>
  <div class="btns">
    <button id="copyBtn">Copy CSS</button>
    <button id="resetBtn">Reset</button>
  </div>
  <div class="hint">ドラッグ：蓋 &amp; 液体枠／2本指ピンチ：液体枠サイズ</div>
</div>

<script>
const $ = s=>document.querySelector(s);
const css = (k,v)=>document.documentElement.style.setProperty(k,v);
const get = k=>getComputedStyle(document.documentElement).getPropertyValue(k).trim();
const fmt = v => (Math.round(v*10)/10).toFixed(1) + '%';

const stage  = $('#stage');
const cap    = $('#Cap');
const liqBox = $('#liqBox');

function updateHUD(){
  capL.textContent=get('--cap-left');
  capT.textContent=get('--cap-top');
  liqL.textContent=get('--liq-left');
  liqT.textContent=get('--liq-top');
  liqW.textContent=get('--liq-width');
  liqH.textContent=get('--liq-height');
}

/* ステージ%に変換 */
function stageRect(){ return stage.getBoundingClientRect(); }
function drag(el, apply){
  let act=false, sx=0, sy=0, baseL=0, baseT=0;
  const down=e=>{
    act=true;
    const p=(e.touches?e.touches[0]:e);
    sx=p.clientX; sy=p.clientY;
    const r=el.getBoundingClientRect(), s=stageRect();
    baseL=((r.left - s.left)/s.width )*100;
    baseT=((r.top  - s.top )/s.height)*100;
    e.preventDefault();
  };
  const move=e=>{
    if(!act) return;
    const p=(e.touches?e.touches[0]:e);
    const s=stageRect();
    const dx=(p.clientX-sx)/s.width *100;
    const dy=(p.clientY-sy)/s.height*100;
    apply(baseL+dx, baseT+dy);
  };
  const up=()=>{ act=false; updateHUD(); };
  el.addEventListener('mousedown',down); window.addEventListener('mousemove',move); window.addEventListener('mouseup',up);
  el.addEventListener('touchstart',down,{passive:false}); window.addEventListener('touchmove',move,{passive:false}); window.addEventListener('touchend',up);
}

/* ピンチで枠サイズ変更 */
(function pinchResize(box){
  let pinch=false, start=0, baseW=0, baseH=0;
  box.addEventListener('touchstart',e=>{
    if(e.touches.length===2){
      pinch=true;
      const [a,b]=e.touches;
      start=Math.hypot(a.clientX-b.clientX,a.clientY-b.clientY);
      const s=stageRect(), r=box.getBoundingClientRect();
      baseW=(r.width /s.width )*100;
      baseH=(r.height/s.height)*100;
    }
  },{passive:false});
  window.addEventListener('touchmove',e=>{
    if(!pinch||e.touches.length!==2) return;
    const [a,b]=e.touches;
    const dist=Math.hypot(a.clientX-b.clientX,a.clientY-b.clientY);
    const scale=dist/start;
    css('--liq-width', fmt(baseW*scale));
    css('--liq-height',fmt(baseH*scale));
    updateHUD();
  },{passive:false});
  window.addEventListener('touchend',()=>{pinch=false});
})(liqBox);

/* ドラッグ適用 */
drag(cap,   (L,T)=>{ css('--cap-left',fmt(L)); css('--cap-top',fmt(T)); });
drag(liqBox,(L,T)=>{ css('--liq-left',fmt(L)); css('--liq-top',fmt(T)); });

/* HUD */
copyBtn.onclick=()=>{
  const txt =
`--cap-left: ${capL.textContent};
--cap-top: ${capT.textContent};
--cap-width: var(--cap-width);

--liq-left: ${liqL.textContent};
--liq-top: ${liqT.textContent};
--liq-width: ${liqW.textContent};
--liq-height: ${liqH.textContent};`;
  navigator.clipboard.writeText(txt);
  copyBtn.textContent='Copied!'; setTimeout(()=>copyBtn.textContent='Copy CSS',900);
};
resetBtn.onclick=()=>{
  css('--cap-top','7%'); css('--cap-left','31%'); css('--cap-width','27%');
  css('--liq-left','19%'); css('--liq-top','47%'); css('--liq-width','62%'); css('--liq-height','30%');
  updateHUD();
};
updateHUD();
</script>
</body>
</html>
